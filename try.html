<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>FCM HTTP v1 Push via Cloudflare Worker</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>
<style>
  body { font-family: Arial; text-align: center; margin-top: 50px; }
  button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>
<h1>Push Notifications with FCM HTTP v1 API</h1>
<button id="subscribe">Subscribe & Save Token</button>
<button id="trigger">Trigger Push</button>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDtZnYYDb5TR01G6zsCtrF0HBR6pnQ2Beg",
    authDomain: "general-68ca7.firebaseapp.com",
    projectId: "general-68ca7",
    storageBucket: "general-68ca7.firebasestorage.app",
    messagingSenderId: "674522865143",
    appId: "1:674522865143:web:c4ec47f2e370c33c3ca2f2",
    measurementId: "G-6L0DXHGCBE"
  };

firebase.initializeApp(firebaseConfig);
const messaging = firebase.messaging();

const publicVapidKey = "BL6h9NFc_O5r-l5JJ6wKpvzuHrI6o76uSTCM7j2KDG_r_Gp2X07QWBnLMak3bwEu2WD6Wbr7H2qyrtBfCNhbN2Q"; // Firebase Web Push VAPID public key
const workerEndpoint = "https://fancy-poetry-027f.nafil-8895-s.workers.dev/fcmpush"; // Your Cloudflare Worker route handling push

document.getElementById("subscribe").onclick = async () => {
  try {
    await Notification.requestPermission();
    const token = await messaging.getToken({ vapidKey: publicVapidKey });
    if (!token) throw new Error("Failed to get FCM token.");
    const res = await fetch(workerEndpoint, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "save", token })
    });
    alert(res.ok ? "Token saved!" : "Failed to save token.");
  } catch (err) {
    alert("Error: " + err.message);
  }
};

document.getElementById("trigger").onclick = async () => {
  try {
    const res = await fetch(workerEndpoint, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "trigger" })
    });
    alert(res.ok ? "Push triggered!" : "Failed to trigger push.");
  } catch (err) {
    alert("Error: " + err.message);
  }
};

// Display foreground notifications
messaging.onMessage(payload => {
  alert(`Foreground notification: ${payload.notification.title} - ${payload.notification.body}`);
});
</script>
</body>
</html>
